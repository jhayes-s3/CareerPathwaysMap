<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Career Pathways</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        :root {
            --bg: #f5f0ff;
            --surface: #ffffff;
            --text: #0a0a1a;
            --muted: #6b6b8a;
            --c1: #ff3cac;   /* pink */
            --c2: #00d4ff;   /* cyan */
            --c3: #7fff00;   /* lime */
            --c4: #ff8c00;   /* orange */
            --c5: #b44fff;   /* purple */
            --c6: #00ffb3;   /* mint */
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Space Grotesk', sans-serif;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Colourful background blobs */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                    radial-gradient(ellipse 600px 400px at 10% 20%, rgba(255,60,172,0.12) 0%, transparent 70%),
                    radial-gradient(ellipse 500px 350px at 90% 10%, rgba(0,212,255,0.12) 0%, transparent 70%),
                    radial-gradient(ellipse 550px 400px at 80% 80%, rgba(127,255,0,0.10) 0%, transparent 70%),
                    radial-gradient(ellipse 450px 300px at 5% 85%, rgba(180,79,255,0.12) 0%, transparent 70%),
                    radial-gradient(ellipse 400px 300px at 50% 50%, rgba(255,140,0,0.06) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        header {
            position: relative;
            z-index: 2;
            text-align: center;
            padding: 3rem 2rem 1rem;
        }

        .eyebrow {
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.72rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--c1);
            background: rgba(255,60,172,0.08);
            border: 1px solid rgba(255,60,172,0.25);
            padding: 0.35em 1em;
            border-radius: 100px;
            margin-bottom: 1.2rem;
        }
        .eyebrow::before { content: '//'; opacity: 0.5; }

        h1 {
            font-size: clamp(2rem, 6vw, 4rem);
            font-weight: 700;
            line-height: 1.05;
            letter-spacing: -0.03em;
            margin-bottom: 0.75rem;
        }

        h1 span.grad {
            background: linear-gradient(90deg, var(--c1) 0%, var(--c5) 40%, var(--c2) 80%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--muted);
            font-size: 1rem;
            font-weight: 400;
            max-width: 520px;
            margin: 0 auto 1.5rem;
            line-height: 1.65;
        }

        /* LEGEND */
        .legend {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            flex-wrap: wrap;
            padding: 0.5rem 2rem 1rem;
            position: relative;
            z-index: 2;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.45rem;
            font-size: 0.72rem;
            font-family: 'JetBrains Mono', monospace;
            color: var(--muted);
            background: white;
            border: 1px solid rgba(0,0,0,0.08);
            padding: 0.3em 0.85em;
            border-radius: 100px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
        }
        .legend-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        /* CANVAS */
        .canvas-wrap {
            position: relative;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0.5rem 1.5rem 1rem;
            z-index: 1;
        }
        #mapCanvas {
            display: block;
            width: 100%;
            border-radius: 20px;
            background: white;
            box-shadow:
                    0 0 0 1px rgba(0,0,0,0.06),
                    0 8px 40px rgba(0,0,0,0.08),
                    0 2px 8px rgba(0,0,0,0.04);
            cursor: grab;
        }
        #mapCanvas:active { cursor: grabbing; }

        .hint {
            text-align: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.68rem;
            color: var(--muted);
            padding: 0.75rem 0 2rem;
            letter-spacing: 0.05em;
            position: relative;
            z-index: 2;
        }
        .hint em {
            color: var(--c1);
            font-style: normal;
        }

        /* OVERLAY */
        .overlay {
            position: fixed; inset: 0;
            background: rgba(10,10,26,0.45);
            backdrop-filter: blur(4px);
            z-index: 99;
            opacity: 0; pointer-events: none;
            transition: opacity 0.3s;
        }
        .overlay.open { opacity: 1; pointer-events: all; }

        /* PANEL */
        .info-panel {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.92) translateY(20px);
            width: min(520px, 92vw);
            background: white;
            border-radius: 20px;
            padding: 2.25rem;
            z-index: 100;
            opacity: 0; pointer-events: none;
            transition: opacity 0.28s cubic-bezier(.4,0,.2,1), transform 0.28s cubic-bezier(.4,0,.2,1);
            box-shadow: 0 24px 80px rgba(0,0,0,0.18), 0 0 0 1px rgba(0,0,0,0.06);
        }
        .info-panel.open {
            opacity: 1; pointer-events: all;
            transform: translate(-50%, -50%) scale(1) translateY(0);
        }

        .panel-stripe {
            height: 4px;
            border-radius: 100px;
            margin-bottom: 1.5rem;
        }

        .panel-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .panel-badge {
            display: inline-flex;
            align-items: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            padding: 0.3em 0.85em;
            border-radius: 100px;
            font-weight: 600;
            margin-bottom: 0.6rem;
        }

        .panel-title {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            line-height: 1.2;
            margin-bottom: 0.25rem;
        }

        .panel-level {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--muted);
            margin-bottom: 1rem;
        }

        .panel-desc {
            font-size: 0.9rem;
            line-height: 1.75;
            color: #3a3a5c;
            margin-bottom: 1.25rem;
            border-left: 3px solid;
            padding-left: 1rem;
        }

        .panel-section-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--muted);
            margin-bottom: 0.6rem;
        }

        .connections-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .conn-pill {
            padding: 0.35em 1em;
            border-radius: 100px;
            font-size: 0.78rem;
            font-weight: 500;
            border: 1.5px solid;
            cursor: pointer;
            transition: all 0.15s;
        }
        .conn-pill:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .close-btn {
            width: 32px; height: 32px;
            border-radius: 50%;
            background: rgba(0,0,0,0.06);
            border: none;
            color: var(--muted);
            font-size: 1.1rem;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0;
            transition: background 0.15s;
            line-height: 1;
        }
        .close-btn:hover { background: rgba(0,0,0,0.12); color: var(--text); }
    </style>
</head>
<body>

<header>
    <p class="eyebrow">Technology &amp; Digital</p>
    <h1>Career <span class="grad">Pathways</span> Map</h1>
    <p class="subtitle">Explore the digital tech landscape — click any node to discover qualifications, roles, and where they can take you.</p>
</header>

<div class="legend">
    <div class="legend-item"><div class="legend-dot" style="background:#ff3cac"></div>Foundations</div>
    <div class="legend-item"><div class="legend-dot" style="background:#00d4ff"></div>Core Skills</div>
    <div class="legend-item"><div class="legend-dot" style="background:#7fff00"></div>Specialist</div>
    <div class="legend-item"><div class="legend-dot" style="background:#ff8c00"></div>Leadership</div>
    <div class="legend-item"><div class="legend-dot" style="background:#b44fff"></div>Advanced / Degree</div>
</div>

<div class="canvas-wrap">
    <canvas id="mapCanvas"></canvas>
</div>

<p class="hint">Click a node to explore · <em>Drag</em> to pan · <em>Scroll</em> to zoom</p>

<div class="overlay" id="overlay"></div>

<div class="info-panel" id="infoPanel">
    <div class="panel-stripe" id="panelStripe"></div>
    <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:1rem">
        <div style="flex:1">
            <div class="panel-badge" id="panelBadge"></div>
            <div class="panel-title" id="panelTitle"></div>
            <div class="panel-level" id="panelLevel"></div>
        </div>
        <button class="close-btn" id="closeBtn">×</button>
    </div>
    <p class="panel-desc" id="panelDesc"></p>
    <div class="panel-section-label">Pathways & connections</div>
    <div class="connections-list" id="connList"></div>
</div>

<script>
    // ─── DATA ─────────────────────────────────────────────────────────────────
    const COLORS = {
        foundations: '#ff3cac',
        core:        '#00d4ff',
        specialist:  '#7fff00',
        leadership:  '#ff8c00',
        advanced:    '#b44fff',
    };

    const nodes = [
        // FOUNDATIONS
        {
            id:'n1', label:'Digital\nBootcamp', category:'foundations',
            level:'Pre-Apprenticeship · Level 2',
            desc:'An intensive introductory programme covering digital literacy, computational thinking, and workplace readiness. The ideal launchpad for anyone entering the tech industry with no prior experience.',
            connections:['n2','n3','n4','n5']
        },
        {
            id:'n2', label:'IT User\nSkills L2', category:'foundations',
            level:'Level 2 Award',
            desc:'Covers essential IT skills: file management, spreadsheets, word processing, email, and internet safety. Provides the bedrock knowledge needed to progress to any technical apprenticeship.',
            connections:['n1','n3','n6','n7']
        },
        {
            id:'n3', label:'CompTIA\nIT Fundamentals', category:'foundations',
            level:'Vendor Certification · Foundation',
            desc:'A globally recognised vendor-neutral certification covering core hardware, software, networking, and security concepts. A strong asset on any tech CV and a natural stepping stone to CompTIA A+.',
            connections:['n1','n2','n6','n8']
        },

        // CORE SKILLS
        {
            id:'n4', label:'Software Dev\nApprenticeship', category:'core',
            level:'Level 3 Apprenticeship',
            desc:'Learn to build web and software applications in a real business environment. Covers Python, JavaScript, databases, version control with Git, and agile methodologies. One of the most in-demand pathways in tech.',
            connections:['n1','n9','n10','n11']
        },
        {
            id:'n5', label:'IT Support\nTechnician', category:'core',
            level:'Level 3 Apprenticeship',
            desc:'Provide first and second-line technical support to organisations. Covers hardware, operating systems, networking, Active Directory, and ticketing systems. An excellent entry into enterprise IT.',
            connections:['n1','n2','n6','n8','n12']
        },
        {
            id:'n6', label:'Network\nTechnician', category:'core',
            level:'Level 3 Apprenticeship',
            desc:'Build and maintain the network infrastructure that keeps organisations running. Covers TCP/IP, routing and switching, VLANs, firewalls, and wireless systems. Prepares students for CCNA or CompTIA Network+.',
            connections:['n2','n3','n5','n12','n13']
        },
        {
            id:'n7', label:'Data Analyst\nApprenticeship', category:'core',
            level:'Level 4 Higher Apprenticeship',
            desc:'Turn raw data into business insights using SQL, Python, Power BI, and Excel. Apprentices work on real datasets, building dashboards and reports that drive decision-making across the organisation.',
            connections:['n2','n14','n15']
        },
        {
            id:'n8', label:'Cybersecurity\nTechnician', category:'core',
            level:'Level 3 Apprenticeship',
            desc:'The front line of digital defence. Covers threat identification, vulnerability scanning, incident response, and security tooling. Prepares apprentices for CompTIA Security+ and a fast-growing career field.',
            connections:['n3','n5','n6','n13','n16']
        },

        // SPECIALIST
        {
            id:'n9', label:'Frontend\nDeveloper', category:'specialist',
            level:'Level 4 Higher Apprenticeship',
            desc:'Specialise in crafting beautiful, accessible user interfaces. Deep dives into React, TypeScript, CSS architecture, performance optimisation, and web accessibility standards (WCAG). Work closely with designers and product teams.',
            connections:['n4','n10','n17']
        },
        {
            id:'n10', label:'Backend\nDeveloper', category:'specialist',
            level:'Level 4 Higher Apprenticeship',
            desc:'Build the engines that power web applications — APIs, databases, authentication systems, and server infrastructure. Covers Node.js, Django or Spring Boot, PostgreSQL, Redis, and RESTful API design.',
            connections:['n4','n9','n11','n17','n18']
        },
        {
            id:'n11', label:'DevOps\nEngineer', category:'specialist',
            level:'Level 4 Higher Apprenticeship',
            desc:'Bridge the gap between development and operations. Covers CI/CD pipelines, Docker, Kubernetes, Terraform, and cloud platforms (AWS/Azure/GCP). A critical role in any modern software engineering team.',
            connections:['n4','n10','n18','n19']
        },
        {
            id:'n12', label:'Cloud\nPractitioner', category:'specialist',
            level:'Level 4 Higher Apprenticeship',
            desc:'Design and manage cloud infrastructure on AWS, Azure, or Google Cloud. Covers virtual machines, storage, IAC, cost optimisation, and cloud security. Prepares apprentices for AWS Solutions Architect or AZ-900 certifications.',
            connections:['n5','n6','n11','n13','n19']
        },
        {
            id:'n13', label:'Security\nAnalyst', category:'specialist',
            level:'Level 4 Higher Apprenticeship',
            desc:'Operate within a Security Operations Centre (SOC), monitoring for threats, analysing logs, and responding to incidents. Covers SIEM tools, threat intelligence platforms, and forensic analysis techniques.',
            connections:['n6','n8','n12','n16']
        },
        {
            id:'n14', label:'ML Engineer', category:'specialist',
            level:'Level 5 Higher Apprenticeship',
            desc:'Build machine learning models and deploy them into production systems. Covers supervised and unsupervised learning, neural networks with PyTorch/TensorFlow, MLOps pipelines, and model evaluation strategies.',
            connections:['n7','n15','n20']
        },
        {
            id:'n15', label:'Data Engineer', category:'specialist',
            level:'Level 5 Higher Apprenticeship',
            desc:'Architect and maintain the data pipelines that feed analytics and AI systems. Covers Apache Spark, Kafka, data warehousing (Snowflake/BigQuery), and orchestration tools like Airflow. Works closely with data analysts and scientists.',
            connections:['n7','n14','n20']
        },

        // ADVANCED / DEGREE
        {
            id:'n16', label:'Cyber Security\nManager L6', category:'advanced',
            level:'Level 6 Degree Apprenticeship',
            desc:'Lead an organisation\'s cybersecurity strategy. Covers enterprise risk management, governance frameworks (ISO 27001, NIST), penetration testing, and board-level security reporting. Pathway to CISSP or CISM certification.',
            connections:['n8','n13']
        },
        {
            id:'n17', label:'Software\nEngineer L6', category:'advanced',
            level:'Level 6 Degree Apprenticeship',
            desc:'Senior-level software engineering combining system design, distributed architecture, and technical leadership. Graduates are equipped for engineering lead or principal engineer roles at scale-ups and enterprises alike.',
            connections:['n9','n10','n21']
        },
        {
            id:'n18', label:'Cloud Architect\nL6', category:'advanced',
            level:'Level 6 Degree Apprenticeship',
            desc:'Design resilient, scalable, and cost-effective cloud-native architectures. Covers multi-cloud strategy, serverless computing, FinOps, and enterprise migration projects. Pathway to AWS Professional or Azure Expert certifications.',
            connections:['n10','n11','n12','n19','n21']
        },
        {
            id:'n19', label:'Platform\nEngineer L6', category:'advanced',
            level:'Level 6 Degree Apprenticeship',
            desc:'Build and maintain the internal developer platforms that enable engineering teams to ship fast and safely. Covers Kubernetes operators, golden paths, developer experience (DX), and internal tooling strategy.',
            connections:['n11','n12','n18']
        },
        {
            id:'n20', label:'AI / Data\nScientist L6', category:'advanced',
            level:'Level 6 Degree Apprenticeship',
            desc:'Apply advanced statistical modelling, deep learning, and NLP to solve complex business problems. Work on LLM fine-tuning, computer vision, recommendation systems, and responsible AI governance.',
            connections:['n14','n15','n21']
        },

        // LEADERSHIP
        {
            id:'n21', label:'Technology\nLeader L7', category:'leadership',
            level:'Level 7 Executive Apprenticeship',
            desc:'The pinnacle of the digital career pathway. Develop the skills to lead engineering organisations — covering technology strategy, engineering culture, P&L management, talent development, and board-level communication. Equivalent to an MBA with a technology focus.',
            connections:['n17','n18','n20']
        },
    ];

    // Node positions [fx, fy] as fractions of canvas W/H
    const positions = {
        // FOUNDATIONS (left cluster)
        n1:  [0.08, 0.50],
        n2:  [0.16, 0.28],
        n3:  [0.16, 0.72],

        // CORE SKILLS (middle-left)
        n4:  [0.30, 0.18],
        n5:  [0.30, 0.45],
        n6:  [0.30, 0.70],
        n7:  [0.30, 0.88],
        n8:  [0.38, 0.62],

        // SPECIALIST (middle-right)
        n9:  [0.50, 0.12],
        n10: [0.52, 0.30],
        n11: [0.54, 0.48],
        n12: [0.52, 0.66],
        n13: [0.50, 0.82],
        n14: [0.44, 0.95],
        n15: [0.38, 0.95],

        // ADVANCED (right)
        n16: [0.68, 0.82],
        n17: [0.68, 0.15],
        n18: [0.72, 0.40],
        n19: [0.72, 0.60],
        n20: [0.65, 0.96],

        // LEADERSHIP (far right)
        n21: [0.88, 0.50],
    };

    const RADII = {
        foundations: 16, core: 18, specialist: 17, advanced: 20, leadership: 26
    };

    // ─── CANVAS ─────────────────────────────────────────────────────────────────
    const canvas = document.getElementById('mapCanvas');
    const ctx = canvas.getContext('2d');
    let W, H, scale = 1, offsetX = 0, offsetY = 0;
    let isDragging = false, dragStart = null, dragOffset = null;
    let hoveredNode = null;
    let pulsePhase = 0;
    let particleT = 0;

    // Animated particles flowing along edges
    const particles = [];
    function initParticles() {
        particles.length = 0;
        nodes.forEach(node => {
            node.connections.forEach(cid => {
                if (node.id < cid) {
                    particles.push({ from: node.id, to: cid, t: Math.random(), speed: 0.003 + Math.random()*0.003 });
                }
            });
        });
    }

    function resize() {
        const wrap = canvas.parentElement;
        W = wrap.clientWidth;
        H = Math.max(580, Math.round(W * 0.58));
        canvas.width = W * devicePixelRatio;
        canvas.height = H * devicePixelRatio;
        canvas.style.width = W + 'px';
        canvas.style.height = H + 'px';
        ctx.scale(devicePixelRatio, devicePixelRatio);
        initParticles();
    }

    function nodeScreen(id) {
        const [fx, fy] = positions[id];
        return { x: fx * W * scale + offsetX, y: fy * H * scale + offsetY };
    }

    function getNodeAt(sx, sy) {
        for (const n of nodes) {
            const p = nodeScreen(n.id);
            const r = RADII[n.category] + 10;
            if (Math.hypot(sx - p.x, sy - p.y) < r) return n;
        }
        return null;
    }

    // ─── DRAW ────────────────────────────────────────────────────────────────────
    function draw() {
        ctx.clearRect(0, 0, W, H);
        pulsePhase += 0.025;
        particleT += 0.016;

        // GRID dots (subtle)
        ctx.fillStyle = 'rgba(0,0,0,0.04)';
        const gstep = 40 * scale;
        const ox = offsetX % gstep;
        const oy = offsetY % gstep;
        for (let x = ox; x < W; x += gstep)
            for (let y = oy; y < H; y += gstep) {
                ctx.beginPath();
                ctx.arc(x, y, 1.2, 0, Math.PI*2);
                ctx.fill();
            }

        // EDGES
        nodes.forEach(node => {
            node.connections.forEach(cid => {
                if (node.id < cid) {
                    const a = nodeScreen(node.id);
                    const b = nodeScreen(cid);
                    const ca = COLORS[node.category];
                    const cb = COLORS[nodes.find(n=>n.id===cid).category];
                    const isHot = hoveredNode && (hoveredNode.id===node.id || hoveredNode.id===cid);

                    ctx.beginPath();
                    ctx.moveTo(a.x, a.y);
                    ctx.lineTo(b.x, b.y);

                    if (isHot) {
                        const g = ctx.createLinearGradient(a.x, a.y, b.x, b.y);
                        g.addColorStop(0, ca + 'cc');
                        g.addColorStop(1, cb + 'cc');
                        ctx.strokeStyle = g;
                        ctx.lineWidth = 2.5;
                        ctx.setLineDash([]);
                    } else {
                        ctx.strokeStyle = 'rgba(0,0,0,0.07)';
                        ctx.lineWidth = 1.2;
                        ctx.setLineDash([5,7]);
                    }
                    ctx.stroke();
                    ctx.setLineDash([]);
                }
            });
        });

        // FLOWING PARTICLES along edges
        particles.forEach(p => {
            p.t = (p.t + p.speed) % 1;
            const a = nodeScreen(p.from);
            const b = nodeScreen(p.to);
            const x = a.x + (b.x - a.x) * p.t;
            const y = a.y + (b.y - a.y) * p.t;
            const col = COLORS[nodes.find(n=>n.id===p.from).category];
            const alpha = 0.3 + Math.sin(p.t * Math.PI) * 0.4;

            ctx.beginPath();
            ctx.arc(x, y, 2.5 * scale, 0, Math.PI*2);
            ctx.fillStyle = col + Math.round(alpha * 255).toString(16).padStart(2,'0');
            ctx.fill();
        });

        // NODES
        nodes.forEach(node => {
            const { x, y } = nodeScreen(node.id);
            const r = RADII[node.category] * scale;
            const color = COLORS[node.category];
            const isHovered = hoveredNode && hoveredNode.id === node.id;
            const isConnected = hoveredNode && hoveredNode.connections.includes(node.id);
            const wobble = Math.sin(pulsePhase + node.id.charCodeAt(1) * 0.7) * 0.5;

            // Shadow / glow
            const glowR = r * (isHovered ? 4 : 2.8);
            const glow = ctx.createRadialGradient(x, y, 0, x, y, glowR);
            glow.addColorStop(0, color + (isHovered ? '50' : '28'));
            glow.addColorStop(1, 'transparent');
            ctx.beginPath();
            ctx.arc(x, y, glowR, 0, Math.PI*2);
            ctx.fillStyle = glow;
            ctx.fill();

            // Pulse ring
            const pr = r + 6 + wobble;
            ctx.beginPath();
            ctx.arc(x, y, pr, 0, Math.PI*2);
            ctx.strokeStyle = color + (isHovered ? '60' : '22');
            ctx.lineWidth = isHovered ? 2 : 1;
            ctx.stroke();

            // Second outer ring for hovered/connected
            if (isHovered || isConnected) {
                ctx.beginPath();
                ctx.arc(x, y, r + 10 + wobble, 0, Math.PI*2);
                ctx.strokeStyle = color + (isHovered ? '40' : '20');
                ctx.lineWidth = 1;
                ctx.stroke();
            }

            // Core
            const core = ctx.createRadialGradient(x - r*0.25, y - r*0.25, r*0.05, x, y, r);
            core.addColorStop(0, '#ffffff');
            core.addColorStop(0.35, color + 'ee');
            core.addColorStop(1, color);
            ctx.beginPath();
            ctx.arc(x, y, r, 0, Math.PI*2);
            ctx.fillStyle = core;
            ctx.fill();

            // White specular
            ctx.beginPath();
            ctx.arc(x - r*0.28, y - r*0.28, r*0.22, 0, Math.PI*2);
            ctx.fillStyle = 'rgba(255,255,255,0.55)';
            ctx.fill();

            // Ring outline
            ctx.beginPath();
            ctx.arc(x, y, r, 0, Math.PI*2);
            ctx.strokeStyle = isHovered ? 'rgba(255,255,255,0.8)' : 'rgba(255,255,255,0.35)';
            ctx.lineWidth = isHovered ? 2.5 : 1.5;
            ctx.stroke();

            // Label
            const fs = Math.max(8, Math.min(11, 10 * scale));
            ctx.font = `600 ${fs}px 'Space Grotesk', sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            const lines = node.label.split('\n');
            const ly = y + r + 5;
            lines.forEach((line, i) => {
                // shadow
                ctx.fillStyle = 'rgba(255,255,255,0.8)';
                ctx.fillText(line, x+0.5, ly + i*(fs+3)+0.5);
                // text
                ctx.fillStyle = isHovered ? color : 'rgba(20,20,50,0.75)';
                ctx.fillText(line, x, ly + i*(fs+3));
            });
        });

        requestAnimationFrame(draw);
    }

    // ─── EVENTS ───────────────────────────────────────────────────────────────
    let _dragMoved = false;
    canvas.addEventListener('mousemove', e => {
        const r = canvas.getBoundingClientRect();
        const sx = (e.clientX - r.left);
        const sy = (e.clientY - r.top);
        if (isDragging) {
            _dragMoved = true;
            offsetX = dragOffset.x + (e.clientX - dragStart.x);
            offsetY = dragOffset.y + (e.clientY - dragStart.y);
            return;
        }
        hoveredNode = getNodeAt(sx, sy);
        canvas.style.cursor = hoveredNode ? 'pointer' : 'grab';
    });

    canvas.addEventListener('mousedown', e => {
        isDragging = true;
        _dragMoved = false;
        dragStart = { x: e.clientX, y: e.clientY };
        dragOffset = { x: offsetX, y: offsetY };
        canvas.style.cursor = 'grabbing';
    });

    canvas.addEventListener('mouseup', e => {
        isDragging = false;
        canvas.style.cursor = hoveredNode ? 'pointer' : 'grab';
        if (!_dragMoved) {
            const r = canvas.getBoundingClientRect();
            const hit = getNodeAt(e.clientX - r.left, e.clientY - r.top);
            if (hit) openPanel(hit);
        }
    });

    canvas.addEventListener('mouseleave', () => { isDragging = false; });

    canvas.addEventListener('wheel', e => {
        e.preventDefault();
        const r = canvas.getBoundingClientRect();
        const mx = e.clientX - r.left, my = e.clientY - r.top;
        const d = e.deltaY > 0 ? 0.88 : 1.12;
        const ns = Math.min(3.5, Math.max(0.35, scale * d));
        offsetX = mx - (mx - offsetX) * (ns / scale);
        offsetY = my - (my - offsetY) * (ns / scale);
        scale = ns;
    }, { passive: false });

    // Touch
    let _touchMoved = false;
    canvas.addEventListener('touchstart', e => {
        if (e.touches.length === 1) {
            isDragging = true; _touchMoved = false;
            dragStart = { x: e.touches[0].clientX, y: e.touches[0].clientY };
            dragOffset = { x: offsetX, y: offsetY };
        }
    }, { passive: true });
    canvas.addEventListener('touchmove', e => {
        if (e.touches.length === 1 && isDragging) {
            _touchMoved = true;
            offsetX = dragOffset.x + (e.touches[0].clientX - dragStart.x);
            offsetY = dragOffset.y + (e.touches[0].clientY - dragStart.y);
        }
    }, { passive: true });
    canvas.addEventListener('touchend', e => {
        isDragging = false;
        if (!_touchMoved && e.changedTouches.length === 1) {
            const t = e.changedTouches[0];
            const r = canvas.getBoundingClientRect();
            const hit = getNodeAt(t.clientX - r.left, t.clientY - r.top);
            if (hit) openPanel(hit);
        }
    }, { passive: true });

    // ─── PANEL ────────────────────────────────────────────────────────────────
    const panel = document.getElementById('infoPanel');
    const overlay = document.getElementById('overlay');

    function openPanel(node) {
        const color = COLORS[node.category];
        document.getElementById('panelStripe').style.background =
            `linear-gradient(90deg, ${color}, ${color}88)`;
        const badge = document.getElementById('panelBadge');
        badge.textContent = node.category.charAt(0).toUpperCase() + node.category.slice(1);
        badge.style.cssText = `background:${color}18;color:${color};border:1.5px solid ${color}55`;
        document.getElementById('panelTitle').textContent = node.label.replace('\n',' ');
        document.getElementById('panelLevel').textContent = '// ' + node.level;
        const desc = document.getElementById('panelDesc');
        desc.textContent = node.desc;
        desc.style.borderLeftColor = color;

        const connList = document.getElementById('connList');
        connList.innerHTML = '';
        node.connections.forEach(cid => {
            const cn = nodes.find(n => n.id === cid);
            const pill = document.createElement('span');
            pill.className = 'conn-pill';
            pill.textContent = cn.label.replace('\n',' ');
            const cc = COLORS[cn.category];
            pill.style.cssText = `color:${cc};background:${cc}12;border-color:${cc}55`;
            pill.addEventListener('click', () => openPanel(cn));
            connList.appendChild(pill);
        });

        panel.classList.add('open');
        overlay.classList.add('open');
    }

    function closePanel() {
        panel.classList.remove('open');
        overlay.classList.remove('open');
    }

    document.getElementById('closeBtn').addEventListener('click', closePanel);
    overlay.addEventListener('click', closePanel);

    // ─── INIT ─────────────────────────────────────────────────────────────────
    window.addEventListener('resize', () => { resize(); });
    resize();
    draw();
</script>
</body>
</html>
